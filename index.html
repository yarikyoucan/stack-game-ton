<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Stack Game</title>

  <!-- Telegram Mini Apps SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js?56"></script>

  <!-- ====== СТИЛІ ====== -->
  <style>
    body{margin:0;font-family:Arial,sans-serif;background:#0f172a;display:flex;flex-direction:column;height:100vh;padding-bottom:64px}
    .page{flex:1;display:none;overflow:auto;padding:10px}.page.active{display:block}

    .menu{display:flex;justify-content:space-around;border-top:1px solid rgba(255,255,255,.15);background:rgba(15,23,42,.75);padding:10px 0;position:fixed;left:0;right:0;bottom:0;z-index:9999;backdrop-filter:blur(6px)}
    .menu button{flex:1;background:none;border:none;font-size:22px;cursor:pointer;color:#fff}.menu button.active{color:#3b82f6;font-weight:bold}

    .task{display:flex;justify-content:space-between;align-items:center;background:#fff;padding:15px;margin:10px auto;border-radius:10px;width:90%;box-shadow:0 2px 5px rgba(0,0,0,.1)}
    .task button{background:#007bff;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}.task button.done{background:#28a745}.task button:disabled{opacity:.6;cursor:not-allowed}
    .balance{font-size:20px;margin-bottom:20px;text-align:center}

    /* ГРА: фон + прозорий canvas */
    #container{
      position:relative;width:100%;height:100%;overflow:hidden;
      background:
        url('data:image/svg+xml;utf8,\
<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160">\
  <defs><radialGradient id="g" cx="40%" cy="40%" r="60%"><stop offset="0%" stop-color="%23fff9c4"/><stop offset="50%" stop-color="%23ffe082"/><stop offset="100%" stop-color="%23ffd54f00"/></radialGradient><clipPath id="crescent"><circle cx="80" cy="80" r="44"/></clipPath></defs>\
  <circle cx="80" cy="80" r="46" fill="%23ffe082" opacity="0.95"/><g clip-path="url(%23crescent)"><circle cx="68" cy="78" r="60" fill="url(%23g)"/></g>\
</svg>') no-repeat 95% 8%,
        url('data:image/svg+xml;utf8,\
<svg xmlns="http://www.w3.org/2000/svg" width="140" height="140" viewBox="0 0 140 140"><g fill="%23ffffff" opacity="0.7">\
<circle cx="15" cy="10" r="1.2"/><circle cx="40" cy="28" r="0.9"/><circle cx="85" cy="20" r="1.1"/><circle cx="120" cy="36" r="1.3"/><circle cx="60" cy="54" r="0.8"/><circle cx="18" cy="72" r="1.0"/><circle cx="100" cy="78" r="1.1"/><circle cx="130" cy="92" r="0.9"/><circle cx="32" cy="110" r="1.2"/><circle cx="72" cy="118" r="0.9"/><circle cx="8" cy="126" r="1.0"/>\
</g></svg>') repeat,
        url('data:image/svg+xml;utf8,\
<svg xmlns="http://www.w3.org/2000/svg" width="800" height="220" viewBox="0 0 800 220">\
  <rect width="800" height="220" fill="none"/>\
  <path d="M0 190 L20 170 L45 172 L45 190 L70 160 L95 162 L95 190 L130 150 L160 152 L160 190 L200 165 L230 167 L230 190 L270 155 L310 157 L310 190 L350 170 L380 172 L380 190 L420 160 L455 162 L455 190 L495 168 L530 170 Л530 190 Л570 156 Л610 158 Л610 190 Л650 170 Л690 172 Л690 190 Л730 160 Л770 165 Л770 190 Л800 150 Л800 220 Л0 220 Z" fill="%23040a1c"/>\
  <path d="M0 200 L30 180 L50 180 L50 200 L80 155 L110 155 Л110 200 Л150 140 Л180 140 Л180 200 Л220 165 Л250 165 Л250 200 Л300 145 Л340 145 Л340 200 Л380 175 Л420 175 Л420 200 Л460 150 Л500 150 Л500 200 Л540 165 Л580 165 Л580 200 Л620 145 Л660 145 Л660 200 Л700 175 Л740 175 Л740 200 Л800 160 Л800 220 Л0 220 Z" fill="%23000a1a"/>\
  <g fill="%23ffd34d">\
    <rect x="58" y="184" width="6" height="10"/><rect x="66" y="184" width="6" height="10" opacity="0.6"/>\
    <rect x="206" y="186" width="6" height="10"/><rect x="214" y="186" width="6" height="10" opacity="0.6"/>\
    <rect x="362" y="188" width="6" height="10"/><rect x="370" y="188" width="6" height="10" opacity="0.6"/>\
    <rect x="526" y="186" width="6" height="10"/><rect x="534" y="186" width="6" height="10" opacity="0.6"/>\
    <rect x="686" y="188" width="6" height="10"/><rect x="694" y="188" width="6" height="10" opacity="0.6"/>\
  </g></svg>') bottom repeat-x,
        linear-gradient(180deg,#1e1b4b 0%, #0b1020 60%, #090f1a 100%);
      background-size:160px 160px,140px 140px,auto 220px,cover;
      background-position:95% 8%,center,bottom,center;
    }
    #container canvas{position:absolute!important;top:0;left:0;width:100%!important;height:100%!important;z-index:1!important;background:transparent!important}
    #scoreboard{position:absolute;top:10px;left:10px;display:flex;gap:10px;z-index:2}
    #score,#highscore{background:rgba(0,0,0,.5);color:#fff;padding:5px 10px;border-radius:6px}
    #instructions{position:absolute;top:50px;left:10px;color:#fff;font-size:16px;background:rgba(0,0,0,.4);padding:4px 8px;border-radius:6px;z-index:2}
    .hide{display:none}
    .game-over,.ready{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;background:rgba(15,23,42,.95);color:#fff;padding:20px;border-radius:10px;display:none;z-index:3;min-width:260px;box-shadow:0 2px 5px rgba(0,0,0,.35)}

    .lang-btn{position:absolute;top:10px;right:10px;z-index:3;background:rgba(255,255,255,.12);color:#eaf2ff;border:1px solid rgba(255,255,255,.25);padding:6px 10px;border-radius:10px;font-weight:800;letter-spacing:.5px;cursor:pointer;backdrop-filter:blur(6px)}
    .lang-btn:hover{filter:brightness(1.05)}

    .share-card{width:90%;margin:12px auto;background:#fff;border-radius:10px;box-shadow:0 2px 5px rgba(0,0,0,.1);padding:16px}
    .share-row{display:flex;gap:8px;margin-top:8px}
    .share-row input{flex:1;padding:8px 10px;border:1px solid #ddd;border-radius:8px;font-size:14px}
    .share-actions{display:flex;gap:8px;margin-top:8px;align-items:center;flex-wrap:wrap}
    .btn{background:#007bff;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;text-decoration:none;display:inline-block}
    .muted{color:#c7d2fe;font-size:12px}
    .ok{color:#198754}.err{color:#dc3545}
    .payout-list{list-style:none;margin:8px 0 0;padding:0}
    .payout-list li{padding:6px 8px;border:1px solid #eee;border-radius:8px;margin-top:6px;font-size:14px}

    .themed{
      position:relative;color:#eef;padding-bottom:84px;
      background:
        radial-gradient(1200px 500px at 15% 0%, rgba(99,102,241,.35), transparent 60%),
        radial-gradient(1000px 600px at 85% 100%, rgba(56,189,248,.25), transparent 60%),
        linear-gradient(135deg,#0f172a 0%, #1e1b4b 45%, #3b82f6 100%);
    }
    #tasks.themed{
      background-image:
        radial-gradient(1200px 500px at 15% 0%, rgba(99,102,241,.35), transparent 60%),
        radial-gradient(1000px 600px at 85% 100%, rgba(56,189,248,.25), transparent 60%),
        linear-gradient(135deg,#0f172a 0%, #1e1b4b 45%, #3b82f6 100%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="620" height="180"><g fill="%23ffffff1f" font-family="Arial, Helvetica, sans-serif" font-size="28" font-weight="800" transform="rotate(-18 310 90)"><text x="-60" y="40">TASKS • TASKS • TASKS • TASKS • TASKS •</text><text x="-60" y="100">TASKS • TASKS • TASKS • TASKS • TASKS •</text><text x="-60" y="160">TASKS • TASKS • TASKS • TASKS • TASKS •</text></g></svg>');
      background-size:auto,auto,auto,620px 180px;background-repeat:no-repeat,no-repeat,no-repeat,repeat;
    }
    #friends.themed{
      background-image:
        radial-gradient(1200px 500px at 15% 0%, rgba(99,102,241,.35), transparent 60%),
        radial-gradient(1000px 600px at 85% 100%, rgba(56,189,248,.25), transparent 60%),
        linear-gradient(135deg,#0f172a 0%, #1e1b4b 45%, #3b82f6 100%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="640" height="180"><g fill="%23ffffff1f" font-family="Arial, Helvetica, sans-serif" font-size="28" font-weight="800" transform="rotate(-18 320 90)"><text x="-60" y="40">WALLET • WALLET • WALLET • WALLET • WALLET •</text><text x="-60" y="100">WALLET • WALLET • WALLET • WALLET • WALLET •</text><text x="-60" y="160">WALLET • WALLET • WALLET • WALLET • WALLET •</text></g></svg>');
      background-size:auto,auto,auto,640px 180px;background-repeat:no-repeat,no-repeat,no-repeat,repeat;
    }
    #shop.themed{
      background-image:
        radial-gradient(1200px 500px at 15% 0%, rgba(99,102,241,.35), transparent 60%),
        radial-gradient(1000px 600px at 85% 100%, rgba(56,189,248,.25), transparent 60%),
        linear-gradient(135deg,#0f172a 0%, #1e1b4b 45%, #3b82f6 100%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="640" height="180"><g fill="%23ffffff1a" font-family="Arial, Helvetica, sans-serif" font-size="28" font-weight="800" transform="rotate(-18 320 90)"><text x="-60" y="40">SHOP • SHOP • SHOP • SHOP • SHOP •</text><text x="-60" y="100">SHOP • SHOP • SHOP • SHOP • SHOP •</text><text x="-60" y="160">SHOP • SHOP • SHOP • SHOP • SHOP •</text></g></svg>');
      background-size:auto,auto,auto,640px 180px;background-repeat:no-repeat,no-repeat,no-repeat,repeat;
    }
    .themed .task,.themed .share-card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.15);color:#eef;backdrop-filter:blur(6px);box-shadow:0 10px 30px rgba(0,0,0,.15)}
    .themed .btn{background:#3b82f6;color:#fff;border:none}
    .themed .btn:hover{filter:brightness(1.05)}

    #tasksTitle{color:#eaf2ff;margin:6px 0 8px 14px;font-size:28px}
    #friends .balance{font-size:30px;font-weight:800;text-align:center;margin:16px 0;color:#eaf2ff}
    #friends h2.wallet-title{color:#eaf2ff;text-align:center;font-size:28px;margin:0 0 20px}

    #tournaments{
      position:relative;color:#eef;padding-bottom:84px;
      background-image:
        radial-gradient(1200px 500px at 15% 0%, rgba(99,102,241,.35), transparent 60%),
        radial-gradient(1000px 600px at 85% 100%, rgba(56,189,248,.25), transparent 60%),
        linear-gradient(135deg,#0f172a 0%, #1e1e4b 45%, #3b82f6 100%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="760" height="200" viewBox="0 0 760 200"><g fill="%23ffffff15" font-family="Arial, Helvetica, sans-serif" font-size="36" font-weight="800" transform="rotate(-18 380 100)"><text x="-60" y="40">BATTLES • BATTLES • BATTLES • BATTLES • BATTLES •</text><text x="-60" y="100">BATTLES • BATTLES • BATTLES • BATTLES • BATTLES •</text><text x="-60" y="160">BATTLES • BATTLES • BATTLES • BATTLES • BATTLES •</text></g></svg>');
      background-size:auto,auto,auto,760px 200px;background-repeat:no-repeat,no-repeat,no-repeat,repeat;
    }
    #tournaments .tour-hero{width:90%;margin:12px auto;padding:16px;border-radius:14px;color:#fff;background:linear-gradient(135deg, rgba(99,102,241,.9), rgba(90,200,250,.9));box-shadow:0 10px 30px rgba(0,0,0,.15)}
    .tour-hero-title{font-size:20px;font-weight:700}.tour-hero-sub{opacity:.95;margin-top:4px}
    #tournaments .challenge-card{width:90%;margin:12px auto;background:rgba(255,255,255,.06);border-radius:12px;border:1px solid rgba(255,255,255,.15);padding:14px;color:#eef;backdrop-filter:blur(6px);box-shadow:0 10px 30px rgba(0,0,0,.15)}
    #tournaments .challenge-row{display:flex;justify-content:space-between;align-items:center;gap:10px;margin:10px 0}
    #tournaments .opponent-score{font-weight:700;font-size:20px}
    #stakeInput{flex:0 0 110px;padding:8px 10px;border:1px solid #ddd;border-radius:8px;font-size:14px}
    .stake-wrap{display:flex;gap:8px;align-items:center;flex:1}
    .challenge-countdown{margin-top:6px;font-weight:600}
    .challenge-actions{display:flex;align-items:center;gap:8px;margin-top:10px}
    #tournaments .btn{background:#3b82f6;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}
    #tournaments .btn:hover{filter:brightness(1.05)}

    .battle-panel{width:92%; margin:14px auto 96px;border-radius:16px; overflow:hidden;background:
      linear-gradient(135deg, rgba(30,27,75,.85), rgba(37,99,235,.85)),
      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="280" height="280" viewBox="0 0 280 280"><g fill="none" stroke="%23ffffff22"><path d="M0 40h280M0 80h280M0 120h280M0 160h280M0 200h280M0 240h280"/><path d="M40 0v280M80 0v280M120 0v280M160 0v280M200 0v280M240 0v280"/></g></svg>') center/280px repeat;
      border:1px solid rgba(255,255,255,.18);color:#eaf2ff; box-shadow:0 10px 30px rgba(0,0,0,.2)}
    .battle-panel .inner{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;padding:14px 16px}
    .battle-panel .title{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.5px;text-transform:uppercase}
    .battle-panel .title .logo{width:38px;height:38px;border-radius:12px;background:radial-gradient(circle at 30% 30%, #93c5fd, #6366f1);box-shadow:inset 0 1px 0 rgba(255,255,255,.35), 0 6px 16px rgba(99,102,241,.35);display:grid;place-items:center;font-size:20px}
    .battle-panel .rules{display:flex;gap:10px;flex:1;min-width:220px;justify-content:center;flex-wrap:wrap}
    .battle-panel .pill{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18);padding:6px 10px;border-radius:999px;font-weight:700;font-size:13px}
    .battle-panel .cta{display:flex;gap:8px;align-items:center}
    .battle-panel .cta .btn{padding:10px 12px;border-radius:10px}

    /* Лідерборд */
    #leaderboard.themed{
      background-image:
        radial-gradient(1200px 500px at 15% 0%, rgba(99,102,241,.35), transparent 60%),
        radial-gradient(1000px 600px at 85% 100%, rgba(56,189,248,.25), transparent 60%),
        linear-gradient(135deg,#0f172a 0%, #1e1b4b 45%, #3b82f6 100%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="760" height="200"><g fill="%23ffffff15" font-family="Arial, Helvetica, sans-serif" font-size="36" font-weight="800" transform="rotate(-18 380 100)"><text x="-60" y="40">LEADERBOARD • LEADERBOARD • LEADERBOARD •</text><text x="-60" y="100">LEADERBOARD • LEADERBOARD • LEADERBOARD •</text><text x="-60" y="160">LEADERBOARD • LEADERBOARD • LEADERBOARD •</text></g></svg>');
      background-size:auto,auto,auto,760px 200px;background-repeat:no-repeat,no-repeat,no-repeat,repeat;
      color:#eaf2ff; padding-bottom:84px;
    }
    .lb-header{width:92%;margin:12px auto 8px}
    .lb-title{font-size:26px;margin:0 0 4px}
    .lb-sub{opacity:.9;margin:0 0 10px}
    .lb-note{width:92%;margin:4px auto 16px;font-size:13px;opacity:.9}
    #lbList{width:92%;margin:0 auto 18px}
    .lb-row{
      display:grid;
      grid-template-columns:56px 1fr 70px 90px;
      align-items:center;gap:10px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.15);
      padding:10px 12px;border-radius:12px;
      backdrop-filter:blur(6px);
      box-shadow:0 8px 20px rgba(0,0,0,.15);
      margin:0 0 8px 0;
    }
    .lb-rank{font-weight:900;font-size:18px;text-align:center}
    .lb-name{display:flex;align-items:center;gap:10px;min-width:0}
    .lb-name img{width:28px;height:28px;border-radius:50%;object-fit:cover;border:1px solid rgba(255,255,255,.3)}
    .lb-name .txt{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .lb-bonus{text-align:center;font-weight:800;opacity:.95}
    .lb-score{text-align:right;font-weight:800}
    .rank-1{background:linear-gradient(135deg,rgba(250,204,21,.25),rgba(255,255,255,.06));border-color:rgba(250,204,21,.6)}
    .rank-2{background:linear-gradient(135deg,rgba(148,163,184,.25),rgba(255,255,255,.06));border-color:rgba(148,163,184,.6)}
    .rank-3{background:linear-gradient(135deg,rgba(244,114,182,.25),rgba(255,255,255,.06));border-color:rgba(244,114,182,.6)}
  </style>

  <!-- Adexium SDK (твій первинний скрипт; якщо не віддасть клас — підстрахуємося нижче) -->
  <script src="https://cdn.tgads.space/assets/js/adexium-widget.min.js"></script>
</head>
<body>

  <!-- GAME -->
  <div id="game" class="page active">
    <div id="container">
      <button id="langToggle" class="lang-btn">UA</button>

      <div id="scoreboard">
        <div id="score">0</div>
        <div id="highscore">🏆 0</div>
      </div>
      <div id="instructions" data-i18n="instructions">
        Клік або пробіл — поставити блок. Після завершення — клікни/пробіл, щоб зіграти ще.
      </div>

      <div class="game-over" id="gameOver">
        <h2 data-i18n="game_over">Гра закінчена</h2>
        <p data-i18n="nice_try">Ти молодець 👍</p>
        <p data-i18n="restart_hint">Клікни або натисни пробіл, щоб почати знову</p>
      </div>

      <div class="ready" id="ready">
        <div id="start-button" style="cursor:pointer;" data-i18n="start_btn">▶ Старт</div>
      </div>

      <div class="game-over" id="postAdTimer" style="display:none;">
        <h2 data-i18n="pause_before_new_game">Пауза перед новою гророю</h2>
        <p><span data-i18n="you_can_start_in">Можна буде почати через:</span>
          <b id="postAdCountdown">15</b> <span data-i18n="sec_suffix">с</span></p>
      </div>
    </div>
  </div>

  <!-- TASKS -->
  <div id="tasks" class="page themed">
    <h2 id="tasksTitle">📋 <span data-i18n="tasks_title">Завдання</span></h2>

    <div class="task">
      <span data-i18n="task_subscribe_text">Підпишись на канал +1⭐</span>
      <button id="subscribeBtn" class="btn" data-i18n="open">Перейти</button>
    </div>

    <div class="task" id="task50" style="justify-content:space-between;">
      <span data-i18n="task_75_text">🎯 Досягни рекорду 75 (+5.15⭐)</span>
      <button id="checkTask50" class="btn" style="margin-left:auto;" data-i18n="check">Перевірити</button>
    </div>

    <!-- ДЕННІ ТАСКИ: 25 переглядів/день кожен (+0.1⭐) -->
    <div class="task" id="taskAdsgramDaily">
      <span>🎬 Adsgram: +0.1⭐ — <b id="adGramCounter">0</b>/25 сьогодні</span>
      <button id="watchAdsgramDailyBtn" class="btn">Дивитись</button>
    </div>

    <div class="task" id="taskAdexiumDaily">
      <span>🎬 Adexium: +0.1⭐ — <b id="adExCounter">0</b>/25 сьогодні</span>
      <button id="watchAdexiumDailyBtn" class="btn">Дивитись</button>
    </div>
    <!-- /ДЕННІ ТАСКИ -->

    <!-- Старі квести 5/10 реклам -->
    <div class="task" id="taskWatch5">
      <span><span data-i18n="task_5ads_text">🎬 Переглянь 5 реклам (+1⭐)</span> — <b id="ad5Counter">0/5</b></span>
      <button id="watchAd5Btn" class="btn" data-i18n="watch">Дивитися</button>
    </div>
    <div class="task" id="taskWatch5Cooldown" style="display:none;">
      <span>⌛ <span data-i18n="task_5ads_available_in">«5 реклам» доступне через:</span>
        <span id="ad5CooldownText">—</span></span>
      <button class="btn" disabled data-i18n="wait">Очікуй…</button>
    </div>

    <div class="task" id="taskWatch10">
      <span><span data-i18n="task_10ads_text">🎬 Переглянь 10 реклам (+1.85⭐)</span> — <b id="ad10Counter">0/10</b></span>
      <button id="watchAd10Btn" class="btn" data-i18n="watch">Дивитися</button>
    </div>
    <div class="task" id="taskWatch10Cooldown" style="display:none;">
      <span>⌛ <span data-i18n="task_10ads_available_in">«10 реклам» доступне через:</span>
        <span id="ad10CooldownText">—</span></span>
      <button class="btn" disabled data-i18n="wait">Очікуй…</button>
    </div>

    <div class="task" id="taskGames100" style="justify-content:space-between;">
      <span data-i18n="task_100games_text">🎮 Зіграй 100 ігор (+5⭐) — зіграно:
        <b id='gamesPlayedCounter'>0</b>/100</span>
      <button id="checkGames100Btn" class="btn" style="margin-left:auto;" data-i18n="check">Перевірити</button>
    </div>
  </div>

  <!-- LEADERBOARD -->
  <div id="leaderboard" class="page themed">
    <div class="lb-header">
      <h2 class="lb-title">🏆 <span data-i18n="lb_title">Лідерборд</span></h2>
      <div class="lb-sub" data-i18n="lb_sub">Попадай у ТОП — отримуй більше ⭐ за місце!</div>
    </div>
    <div id="lbList"></div>
    <div class="lb-note" id="lbNote"></div>
  </div>

  <!-- TOURNAMENTS (БАТЛИ) -->
  <div id="tournaments" class="page">
    <div class="tour-hero">
      <div class="tour-hero-title" data-i18n="b_tour_title">⚔️ Виклик суперника</div>
      <div class="tour-hero-sub" data-i18n="b_tour_sub">Згенеруй рекорд, зроби ставку ⭐ і побий його за 3 години</div>
    </div>

    <div class="challenge-card">
      <div class="challenge-row">
        <div>
          <div class="muted" data-i18n="opponent">Суперник</div>
          <div class="opponent-score" id="opponentScore">—</div>
        </div>
        <button class="btn" id="genOpponentBtn" data-i18n="generate">Згенерувати</button>
      </div>

      <div class="challenge-row">
        <label for="stakeInput" class="muted" data-i18n="stake">Ставка ⭐</label>
        <div class="stake-wrap">
          <input id="stakeInput" type="number" min="1" step="0.5" value="1" />
          <button class="btn" id="startChallengeBtn" data-i18n="start_challenge">Почати виклик (3 год)</button>
        </div>
      </div>

      <div class="challenge-info" id="challengeInfo" data-i18n="no_active_challenge">Немає активного виклику.</div>

      <div class="challenge-countdown" id="challengeCountdown" style="display:none;">
        ⏳ <span data-i18n="time_left_prefix">Залишилось:</span> <span id="challengeLeft">03:00:00</span>
      </div>

      <div class="challenge-actions">
        <button class="btn" id="checkChallengeBtn" disabled data-i18n="check">Перевірити</button>
        <span id="challengeStatus" class="muted"></span>
      </div>
    </div>

    <div class="battle-panel" aria-label="Правила батлу">
      <div class="inner">
        <div class="title">
          <div class="logo">⚔️</div>
          <div>BATTLES</div>
        </div>
        <div class="rules">
          <div class="pill" data-i18n="rule_goal">🎯 Мета: побий рекорд за 3 год</div>
          <div class="pill" data-i18n="rule_prize">💎 Виграш: ×1.5 від ставки</div>
          <div class="pill" data-i18n="rule_risk">⚠️ Якщо не встигаєш — ставка згорає</div>
        </div>
        <div class="cta">
          <button class="btn" onclick="document.getElementById('stakeInput').focus()" data-i18n="make_bet">Зробити ставку</button>
        </div>
      </div>
    </div>
  </div>

  <!-- FRIENDS / WALLET -->
  <div id="friends" class="page themed">
    <div class="balance"><span data-i18n="balance">Баланс</span> ⭐ <span id="balance">0</span></div>
    <h2 class="wallet-title">💳 <span data-i18n="wallet">Гаманець</span></h2>

    <div class="share-card">
      <div><strong data-i18n="invite_friends">Запроси друзів</strong></div>
      <p class="muted" data-i18n="bot_link">Посилання на бота:</p>
      <p style="margin:8px 0;">
        <a href="https://t.me/Stacktongame_bot" class="btn" onclick="openBotLink(event)" data-i18n="open_bot">➡ Відкрити бота @Stacktongame_bot</a>
      </p>
      <div class="share-row">
        <input id="shareLink" type="text" readonly value="https://t.me/Stacktongame_bot"/>
        <button class="btn" id="copyShareBtn" data-i18n="copy">Скопіювати</button>
      </div>
      <div class="muted" data-i18n="one_link">Це одна силка для всіх 👍</div>
    </div>

    <div class="share-card"></div>
  </div>

  <!-- ====== НИЖНЄ МЕНЮ ====== -->
  <div class="menu">
    <button onclick="showPage('game')" class="active">Гра</button>
    <button onclick="showPage('tasks')">Завдання</button>
    <button onclick="showPage('leaderboard')">Топ</button>
    <button onclick="showPage('tournaments')">Батли</button>
    <button onclick="showPage('friends')">Гаманець</button>
  </div>

  <!-- ====== РОУТІНГ ВКЛАДОК ====== -->
  <script>
    function showPage(id){
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      const labelsUa = ["Гра","Завдання","Топ","Батли","Гаманець"];
      const labelsEn = ["Game","Tasks","Top","Battles","Wallet"];
      const lang = localStorage.getItem('lang')==='en' ? 'en' : 'ua';
      const labels = lang==='en' ? labelsEn : labelsUa;
      document.querySelectorAll('.menu button').forEach((b,i)=>{
        b.classList.remove('active');
        if(b.textContent.trim()===labels[
          id==='game'?0:id==='tasks'?1:id==='leaderboard'?2:id==='tournaments'?3:4
        ]) b.classList.add('active');
      });
    }
  </script>

  <!-- ====== ADEXIUM інтеграція для кнопки +0.1⭐ ====== -->
  <script>
    const ADEXIUM_WIDGET_ID = 'YOUR_WIDGET_ID';   // ← ВСТАВ СВІЙ WID
    const ADEXIUM_DAILY_LIMIT = 25;
    const ADEXIUM_REWARD = 0.1;
    const ADEXIUM_DEBUG = false;

    const store = {
      get(key, def){ try{ return JSON.parse(localStorage.getItem(key)) ?? def; }catch(e){ return def; } },
      set(key, val){ localStorage.setItem(key, JSON.stringify(val)); }
    };
    function todayKey(base){
      const d = new Date();
      const day = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
      return `${base}:${day}`;
    }
    function getBalance(){ return Number(store.get('balance', 0)); }
    function addBalance(delta){
      const v = Math.max(0, Number(getBalance() + delta));
      store.set('balance', v);
      const el = document.getElementById('balance');
      if(el) el.textContent = v.toFixed(2).replace('.', ',');
    }
    function incDailyCounter(keyId){
      const k = todayKey(keyId);
      const v = Number(store.get(k, 0)) + 1;
      store.set(k, v);
      return v;
    }
    function getDailyCounter(keyId){
      const k = todayKey(keyId);
      return Number(store.get(k, 0));
    }
    function refreshAdexiumUi(){
      const cnt = getDailyCounter('adexiumDaily');
      const el  = document.getElementById('adExCounter');
      if(el) el.textContent = cnt;
      const btn = document.getElementById('watchAdexiumDailyBtn');
      if(btn) btn.disabled = cnt >= ADEXIUM_DAILY_LIMIT;
    }
    document.addEventListener('DOMContentLoaded', ()=>{
      refreshAdexiumUi();
      addBalance(0);
    });

    function ensureAdexiumReady(){
      return new Promise((resolve) => {
        if (window.AdexiumWidget) return resolve(true);
        const s = document.createElement('script');
        s.src = 'https://cdn.adexium.tech/assets/js/adexium-widget.min.js';
        s.onload = () => resolve(true);
        s.onerror = () => resolve(false);
        document.head.appendChild(s);
      });
    }

    let adexiumInstance = null;
    let adexiumBound = false;

    async function onAdexiumDailyClick(){
      const btn = document.getElementById('watchAdexiumDailyBtn');
      if (!btn) return;

      const used = getDailyCounter('adexiumDaily');
      if (used >= ADEXIUM_DAILY_LIMIT){
        btn.disabled = true;
        return;
      }

      const ok = await ensureAdexiumReady();
      if (!ok || !window.AdexiumWidget){
        alert('Реклама тимчасово недоступна. Спробуй пізніше.');
        return;
      }

      if (!adexiumInstance){
        adexiumInstance = new window.AdexiumWidget({
          wid: ADEXIUM_WIDGET_ID,
          adFormat: 'interstitial',
          debug: ADEXIUM_DEBUG,
          isFullScreen: true
        });
      }
      if (!adexiumBound){
        adexiumBound = true;

        adexiumInstance.on('adReceived', (ad) => {
          try { adexiumInstance.displayAd(ad); } catch(e){ console.error(e); }
        });
        adexiumInstance.on('noAdFound', () => {
          alert('Наразі немає реклами. Спробуй пізніше.');
        });
        adexiumInstance.on('adPlaybackCompleted', () => {
          const newCount = incDailyCounter('adexiumDaily');
          addBalance(ADEXIUM_REWARD);
          refreshAdexiumUi();
          const msg = `+${ADEXIUM_REWARD}⭐ за перегляд (${newCount}/${ADEXIUM_DAILY_LIMIT} сьогодні)`;
          try{ window.Telegram?.WebApp?.showPopup?.({title:'Нагорода', message: msg, buttons:[{type:'ok'}]}); }catch(_){}
        });
        adexiumInstance.on('adDisplayed', ()=>console.log('[Adexium] показано'));
        adexiumInstance.on('adRedirected', ()=>console.log('[Adexium] клік/перехід'));
        adexiumInstance.on('adClosed', ()=>console.log('[Adexium] закрито'));
      }

      try{
        btn.disabled = true;
        adexiumInstance.requestAd('interstitial');
      }catch(e){
        alert('Не вдалося показати рекламу. Спробуй ще раз.');
      }finally{
        setTimeout(()=>{
          const cnt = getDailyCounter('adexiumDaily');
          btn.disabled = cnt >= ADEXIUM_DAILY_LIMIT;
        }, 1500);
      }
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      const btn = document.getElementById('watchAdexiumDailyBtn');
      if (btn) btn.addEventListener('click', onAdexiumDailyClick);
    });
  </script>

  <!-- ===== i18n (UA/EN) ===== -->
  <script>
  const I18N = {
    ua: {
      instructions: "Клік або пробіл — поставити блок. Після завершення — клікни/пробіл, щоб зіграти ще.",
      game_over: "Гра закінчена",
      nice_try: "Ти молодець 👍",
      restart_hint: "Клікни або натисни пробіл, щоб почати знову",
      pause_before_new_game: "Пауза перед новою грою",
      you_can_start_in: "Можна буде почати через:",
      sec_suffix: "с",
      tasks_title: "Завдання",
      open: "Перейти",
      task_subscribe_text: "Підпишись на канал +1⭐",
      task_75_text: "🎯 Досягни рекорду 75 (+5.15⭐)",
      check: "Перевірити",
      task_5ads_text: "🎬 Переглянь 5 реклам (+1⭐)",
      watch: "Дивитися",
      task_5ads_available_in: "«5 реклам» доступне через:",
      wait: "Очікуй…",
      task_10ads_text: "🎬 Переглянь 10 реклам (+1.85⭐)",
      task_10ads_available_in: "«10 реклам» доступне через:",
      task_100games_text: "🎮 Зіграй 100 ігор (+5⭐) — зіграно:",
      b_tour_title: "⚔️ Виклик суперника",
      b_tour_sub: "Згенеруй рекорд, зроби ставку ⭐ і побий його за 3 години",
      opponent: "Суперник",
      generate: "Згенерувати",
      stake: "Ставка ⭐",
      start_challenge: "Почати виклик (3 год)",
      no_active_challenge: "Немає активного виклику.",
      time_left_prefix: "Залишилось:",
      make_bet: "Зробити ставку",
      balance: "Баланс",
      wallet: "Гаманець",
      lb_title: "Лідерборд",
      lb_sub: "Попадай у ТОП — отримуй більше ⭐ за місце!",
      rule_goal: "🎯 Мета: побий рекорд за 3 год",
      rule_prize: "💎 Виграш: ×1.5 від ставки",
      rule_risk: "⚠️ Якщо не встигаєш — ставка згорає",
    },
    en: {
      instructions: "Click or Space — drop the block. After game over — click/Space to play again.",
      game_over: "Game Over",
      nice_try: "Nice try 👍",
      restart_hint: "Click or press Space to restart",
      pause_before_new_game: "Pause before new game",
      you_can_start_in: "You can start in:",
      sec_suffix: "s",
      tasks_title: "Tasks",
      open: "Open",
      task_subscribe_text: "Subscribe to the channel +1⭐",
      task_75_text: "🎯 Reach score 75 (+5.15⭐)",
      check: "Check",
      task_5ads_text: "🎬 Watch 5 ads (+1⭐)",
      watch: "Watch",
      task_5ads_available_in: "“5 ads” available in:",
      wait: "Wait…",
      task_10ads_text: "🎬 Watch 10 ads (+1.85⭐)",
      task_10ads_available_in: "“10 ads” available in:",
      task_100games_text: "🎮 Play 100 games (+5⭐) — played:",
      b_tour_title: "⚔️ Challenge an opponent",
      b_tour_sub: "Generate a record, place a ⭐ bet and beat it within 3 hours",
      opponent: "Opponent",
      generate: "Generate",
      stake: "Bet ⭐",
      start_challenge: "Start challenge (3h)",
      no_active_challenge: "No active challenge.",
      time_left_prefix: "Time left:",
      make_bet: "Make a bet",
      balance: "Balance",
      wallet: "Wallet",
      lb_title: "Leaderboard",
      lb_sub: "Reach TOP — earn more ⭐ for your place!",
      rule_goal: "🎯 Goal: beat the record in 3h",
      rule_prize: "💎 Prize: ×1.5 of the bet",
      rule_risk: "⚠️ If you fail — the bet burns",
    }
  };

  function applyI18n(lang){
    const dict = I18N[lang] || I18N.ua;
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const k = el.getAttribute('data-i18n');
      if (dict[k] !== undefined){
        el.textContent = dict[k];
      }
    });
    const menuUa = ["Гра","Завдання","Топ","Батли","Гаманець"];
    const menuEn = ["Game","Tasks","Top","Battles","Wallet"];
    const labels = (lang==='en') ? menuEn : menuUa;
    document.querySelectorAll('.menu button').forEach((b,i)=>{ if(labels[i]) b.textContent = labels[i]; });
    const toggle = document.getElementById('langToggle');
    if(toggle) toggle.textContent = (lang==='en' ? 'EN' : 'UA');
  }
  function setLang(lang){
    localStorage.setItem('lang', lang);
    applyI18n(lang);
  }
  document.addEventListener('DOMContentLoaded', ()=>{
    const saved = localStorage.getItem('lang') || 'ua';
    applyI18n(saved);
    const toggle = document.getElementById('langToggle');
    if (toggle){
      toggle.addEventListener('click', ()=>{
        const next = (localStorage.getItem('lang')==='en') ? 'ua' : 'en';
        setLang(next);
      });
    }
  });
  </script>

</body>
</html>

