<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="theme-color" content="#0f172a" />
  <title>Stack Game</title>

  <script src="https://telegram.org/js/telegram-web-app.js?56"></script>

  <style>
    /* --- –ë–ê–ó–ê –Ü–ù–¢–ï–†–§–ï–ô–°–£ --- */
    :root{
      --topbar-h:56px;
      --menu-h:64px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;font-family:Arial,sans-serif;background:#0f172a;
      display:flex;flex-direction:column;height:100vh;padding-bottom:var(--menu-h);
    }
    .page{flex:1;display:none;overflow:auto;padding:10px}
    .page.active{display:block}

    /* ===== –í–ï–†–•–ù–Ø –ü–ê–ù–ï–õ–¨ ‚Äî –¢–Ü–õ–¨–ö–ò –î–õ–Ø –í–ö–õ–ê–î–ö–ò "–ì–†–ê" ===== */
    #game .topbar{
      position:fixed;top:0;left:0;right:0;height:var(--topbar-h);
      display:flex;align-items:center;justify-content:space-between;
      padding:8px 12px;background:rgba(15,23,42,.88);
      backdrop-filter:blur(6px);border-bottom:1px solid rgba(255,255,255,.15);
      z-index:1000;
    }
    .tb-left,.tb-mid,.tb-right{display:flex;align-items:center;gap:10px}
    .tb-left{min-width:0}
    .tb-mid{gap:8px}
    .tb-right{gap:10px}

    .tb-left img{
      width:32px;height:32px;border-radius:50%;object-fit:cover;
      border:2px solid rgba(255,255,255,.9)
    }
    /* –¢–µ–≥ ‚Äî –±—ñ–ª–∏–π + –µ–ª—ñ–ø—Å–∏—Å */
    .tg-tag{
      color:#fff;font-weight:800;letter-spacing:.2px;
      max-width:160px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:1;
    }

    /* –û–¥–Ω–∞–∫–æ–≤–∞ –≤–∏—Å–æ—Ç–∞ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ 32px */
    #score,#highscore,.lang-btn{
      height:32px;display:flex;align-items:center;line-height:1
    }
    #score,#highscore{
      background:rgba(255,255,255,.12);color:#fff;padding:0 12px;border-radius:10px;
      font-weight:800;border:1px solid rgba(255,255,255,.25)
    }
    .lang-btn{
      background:rgba(255,255,255,.12);color:#eaf2ff;border:1px solid rgba(255,255,255,.25);
      padding:0 12px;border-radius:10px;font-weight:800;letter-spacing:.5px;cursor:pointer;backdrop-filter:blur(6px)
    }
    .lang-btn:hover{filter:brightness(1.05)}

    /* --- –ù–ò–ñ–ù–Ñ –ú–ï–ù–Æ --- */
    .menu{
      display:flex;justify-content:space-around;border-top:1px solid rgba(255,255,255,.15);
      background:rgba(15,23,42,.75);padding:10px 0;position:fixed;left:0;right:0;bottom:0;
      z-index:9999;backdrop-filter:blur(6px)
    }
    .menu button{flex:1;background:none;border:none;font-size:22px;cursor:pointer;color:#fff}
    .menu button.active{color:#3b82f6;font-weight:bold}

    .task{display:flex;justify-content:space-between;align-items:center;background:#fff;padding:15px;margin:10px auto;border-radius:10px;width:90%;box-shadow:0 2px 5px rgba(0,0,0,.1)}
    .task button{background:#007bff;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}
    .task button.done{background:#28a745}
    .task button:disabled{opacity:.6;cursor:not-allowed}
    .balance{font-size:20px;margin-bottom:20px;text-align:center}

    /* --- –ì–†–ê: —Ñ–æ–Ω –Ω–µ–±–∞ --- */
    #container{
      position:relative;width:100%;height:100%;overflow:hidden;
      /* —â–æ–± —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è/–∫–∞–Ω–≤–∞—Å –Ω–µ –ª—ñ–∑–ª–∏ –ø—ñ–¥ —Ç–æ–ø–±–∞—Ä: */
      padding-top:calc(var(--topbar-h) + 8px);
      background:
        url('data:image/svg+xml;utf8,\
<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160">\
  <defs><radialGradient id="g" cx="40%" cy="40%" r="60%"><stop offset="0%" stop-color="%23fff9c4"/><stop offset="50%" stop-color="%23ffe082"/><stop offset="100%" stop-color="%23ffd54f00"/></radialGradient><clipPath id="crescent"><circle cx="80" cy="80" r="44"/></clipPath></defs>\
  <circle cx="80" cy="80" r="46" fill="%23ffe082" opacity="0.95"/><g clip-path="url(%23crescent)"><circle cx="68" cy="78" r="60" fill="url(%23g)"/></g>\
</svg>') no-repeat 95% 8%,
        url('data:image/svg+xml;utf8,\
<svg xmlns="http://www.w3.org/2000/svg" width="140" height="140" viewBox="0 0 140 140"><g fill="%23ffffff" opacity="0.7">\
<circle cx="15" cy="10" r="1.2"/><circle cx="40" cy="28" r="0.9"/><circle cx="85" cy="20" r="1.1"/><circle cx="120" cy="36" r="1.3"/><circle cx="60" cy="54" r="0.8"/><circle cx="18" cy="72" r="1.0"/><circle cx="100" cy="78" r="1.1"/><circle cx="130" cy="92" r="0.9"/><circle cx="32" cy="110" r="1.2"/><circle cx="72" cy="118" r="0.9"/><circle cx="8" cy="126" r="1.0"/>\
</g></svg>') repeat,
        linear-gradient(180deg,#1e1b4b 0%, #0b1020 60%, #090f1a 100%);
      background-size:160px 160px,140px 140px,cover;
      background-position:95% 8%,center,center;
    }
    #container canvas{position:absolute!important;top:0;left:0;width:100%!important;height:100%!important;z-index:1!important;background:transparent!important}

    /* –ü—ñ–¥–∫–∞–∑–∫–∏/–º–æ–¥–∞–ª–∫–∏ –≥—Ä–∏ */
    #instructions{position:absolute;top:calc(var(--topbar-h) + 14px);left:10px;color:#fff;font-size:16px;background:rgba(0,0,0,.4);padding:4px 8px;border-radius:6px;z-index:2}
    .hide{display:none}
    .game-over,.ready{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;background:rgba(15,23,42,.95);color:#fff;padding:20px;border-radius:10px;display:none;z-index:3;min-width:260px;box-shadow:0 2px 5px rgba(0,0,0,.35)}

    /* ===== –ù–ï–ü–†–û–ó–û–†–Ü –ë–ê–ì–ê–¢–û–ü–û–í–ï–†–Ü–í–ö–ò (–Ω—ñ—á–Ω–∏–π –≤–∏–¥) ===== */
    .city-skyline{
      position:fixed;left:0;right:0;bottom:var(--menu-h);height:36vh;
      display:flex;align-items:flex-end;gap:10px;padding:0 12px;
      z-index:0;pointer-events:none;
    }
    .city-skyline .bldg{
      width:clamp(44px,7vw,96px);
      height:var(--h,24vh);
      position:relative;overflow:hidden;
      background:
        radial-gradient(180% 90% at 50% 100%, rgba(0,0,0,.35), transparent 55%),
        linear-gradient(to top,#0b1020 0%, #0f1a2b 55%, #111827 100%);
      border:1px solid #101522;border-radius:4px;
      box-shadow:inset 0 -2px 0 rgba(255,255,255,.03),0 10px 28px rgba(0,0,0,.45);
    }
    .city-skyline .bldg::before{
      content:"";position:absolute;left:0;right:0;top:-4px;height:4px;
      background:#0a0f1a;border-bottom:1px solid #0f172a;border-radius:3px 3px 0 0;
    }
    .city-skyline .bldg::after{
      content:"";position:absolute;inset:0;
      background:linear-gradient(90deg, rgba(255,255,255,.06), rgba(255,255,255,0) 22% 78%, rgba(255,255,255,.05));
      mix-blend-mode:screen;opacity:.35;pointer-events:none;
    }
    .city-skyline .bldg .win{
      position:absolute;inset:12px 8px 10px;
      background-repeat:no-repeat;background-size:100% 100%;
      image-rendering:crisp-edges;
      animation:twinkle var(--twinkle,6s) ease-in-out infinite;
      animation-delay:var(--twinkle-delay,0s);
      filter:saturate(1.05) contrast(1.02);
    }
    @keyframes twinkle{
      0%,100%{opacity:1}
      50%{opacity:.96}
    }

    /* –¢–ï–ú–ò –¢–ê –†–ï–®–¢–ê */
    .share-card{width:90%;margin:12px auto;background:#fff;border-radius:10px;box-shadow:0 2px 5px rgba(0,0,0,.1);padding:16px}
    .share-row{display:flex;gap:8px;margin-top:8px}
    .share-row input{flex:1;padding:8px 10px;border:1px solid #ddd;border-radius:8px;font-size:14px}
    .share-actions{display:flex;gap:8px;margin-top:8px;align-items:center;flex-wrap:wrap}
    .btn{background:#007bff;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;text-decoration:none;display:inline-block}
    .muted{color:#c7d2fe;font-size:12px}
    .ok{color:#198754}.err{color:#dc3545}
    .payout-list{list-style:none;margin:8px 0 0;padding:0}
    .payout-list li{padding:6px 8px;border:1px solid #eee;border-radius:8px;margin-top:6px;font-size:14px}

    .themed{
      position:relative;color:#eef;padding-bottom:calc(var(--menu-h) + 20px);
      background:
        radial-gradient(1200px 500px at 15% 0%, rgba(99,102,241,.35), transparent 60%),
        radial-gradient(1000px 600px at 85% 100%, rgba(56,189,248,.25), transparent 60%),
        linear-gradient(135deg,#0f172a 0%, #1e1b4b 45%, #3b82f6 100%);
    }
    #tasks.themed{
      background-image:
        radial-gradient(1200px 500px at 15% 0%, rgba(99,102,241,.35), transparent 60%),
        radial-gradient(1000px 600px at 85% 100%, rgba(56,189,248,.25), transparent 60%),
        linear-gradient(135deg,#0f172a 0%, #1e1b4b 45%, #3b82f6 100%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="620" height="180"><g fill="%23ffffff1f" font-family="Arial, Helvetica, sans-serif" font-size="28" font-weight="800" transform="rotate(-18 310 90)"><text x="-60" y="40">TASKS ‚Ä¢ TASKS ‚Ä¢ TASKS ‚Ä¢ TASKS ‚Ä¢ TASKS ‚Ä¢</text><text x="-60" y="100">TASKS ‚Ä¢ TASKS ‚Ä¢ TASKS ‚Ä¢ TASKS ‚Ä¢ TASKS ‚Ä¢</text><text x="-60" y="160">TASKS ‚Ä¢ TASKS ‚Ä¢ TASKS ‚Ä¢ TASKS ‚Ä¢ TASKS ‚Ä¢</text></g></svg>');
      background-size:auto,auto,auto,620px 180px;background-repeat:no-repeat,no-repeat,no-repeat,repeat;
    }
    #friends.themed{
      background-image:
        radial-gradient(1200px 500px at 15% 0%, rgba(99,102,241,.35), transparent 60%),
        radial-gradient(1000px 600px at 85% 100%, rgba(56,189,248,.25), transparent 60%),
        linear-gradient(135deg,#0f172a 0%, #1e1b4b 45%, #3b82f6 100%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="640" height="180"><g fill="%23ffffff1f" font-family="Arial, Helvetica, sans-serif" font-size="28" font-weight="800" transform="rotate(-18 320 90)"><text x="-60" y="40">WALLET ‚Ä¢ WALLET ‚Ä¢ WALLET ‚Ä¢ WALLET ‚Ä¢ WALLET ‚Ä¢</text><text x="-60" y="100">WALLET ‚Ä¢ WALLET ‚Ä¢ WALLET ‚Ä¢ WALLET ‚Ä¢ WALLET ‚Ä¢</text><text x="-60" y="160">WALLET ‚Ä¢ WALLET ‚Ä¢ WALLET ‚Ä¢ WALLET ‚Ä¢ WALLET ‚Ä¢</text></g></svg>');
      background-size:auto,auto,auto,640px 180px;background-repeat:no-repeat,no-repeat,no-repeat,repeat;
    }
    #shop.themed{
      background-image:
        radial-gradient(1200px 500px at 15% 0%, rgba(99,102,241,.35), transparent 60%),
        radial-gradient(1000px 600px at 85% 100%, rgba(56,189,248,.25), transparent 60%),
        linear-gradient(135deg,#0f172a 0%, #1e1b4b 45%, #3b82f6 100%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="640" height="180"><g fill="%23ffffff1a" font-family="Arial, Helvetica, sans-serif" font-size="28" font-weight="800" transform="rotate(-18 320 90)"><text x="-60" y="40">SHOP ‚Ä¢ SHOP ‚Ä¢ SHOP ‚Ä¢ SHOP ‚Ä¢ SHOP ‚Ä¢</text><text x="-60" y="100">SHOP ‚Ä¢ SHOP ‚Ä¢ SHOP ‚Ä¢ SHOP ‚Ä¢ SHOP ‚Ä¢</text><text x="-60" y="160">SHOP ‚Ä¢ SHOP ‚Ä¢ SHOP ‚Ä¢ SHOP ‚Ä¢ SHOP ‚Ä¢</text></g></svg>');
      background-size:auto,auto,auto,640px 180px;background-repeat:no-repeat,no-repeat,no-repeat,repeat;
    }
    .themed .task,.themed .share-card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.15);color:#eef;backdrop-filter:blur(6px);box-shadow:0 10px 30px rgba(0,0,0,.15)}
    .themed .btn{background:#3b82f6;color:#fff;border:none}
    .themed .btn:hover{filter:brightness(1.05)}

    #tasksTitle{color:#eaf2ff;margin:6px 0 8px 14px;font-size:28px}
    #friends .balance{font-size:30px;font-weight:800;text-align:center;margin:16px 0;color:#eaf2ff}
    #friends h2.wallet-title{color:#eaf2ff;text-align:center;font-size:28px;margin:0 0 20px}

    #tournaments{
      position:relative;color:#eef;padding-bottom:calc(var(--menu-h) + 20px);
      background-image:
        radial-gradient(1200px 500px at 15% 0%, rgba(99,102,241,.35), transparent 60%),
        radial-gradient(1000px 600px at 85% 100%, rgba(56,189,248,.25), transparent 60%),
        linear-gradient(135deg,#0f172a 0%, #1e1e4b 45%, #3b82f6 100%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="760" height="200" viewBox="0 0 760 200"><g fill="%23ffffff15" font-family="Arial, Helvetica, sans-serif" font-size="36" font-weight="800" transform="rotate(-18 380 100)"><text x="-60" y="40">BATTLES ‚Ä¢ BATTLES ‚Ä¢ BATTLES ‚Ä¢ BATTLES ‚Ä¢ BATTLES ‚Ä¢</text><text x="-60" y="100">BATTLES ‚Ä¢ BATTLES ‚Ä¢ BATTLES ‚Ä¢ BATTLES ‚Ä¢ BATTLES ‚Ä¢</text><text x="-60" y="160">BATTLES ‚Ä¢ BATTLES ‚Ä¢ BATTLES ‚Ä¢ BATTLES ‚Ä¢ BATTLES ‚Ä¢</text></g></svg>');
      background-size:auto,auto,auto,760px 200px;background-repeat:no-repeat,no-repeat,no-repeat,repeat;
    }
    #tournaments .tour-hero{width:90%;margin:12px auto;padding:16px;border-radius:14px;color:#fff;background:linear-gradient(135deg, rgba(99,102,241,.9), rgba(90,200,250,.9));box-shadow:0 10px 30px rgba(0,0,0,.15)}
    .tour-hero-title{font-size:20px;font-weight:700}.tour-hero-sub{opacity:.95;margin-top:4px}
    #tournaments .challenge-card{width:90%;margin:12px auto;background:rgba(255,255,255,.06);border-radius:12px;border:1px solid rgba(255,255,255,.15);padding:14px;color:#eef;backdrop-filter:blur(6px);box-shadow:0 10px 30px rgba(0,0,0,.15)}
    #tournaments .challenge-row{display:flex;justify-content:space-between;align-items:center;gap:10px;margin:10px 0}
    #tournaments .opponent-score{font-weight:700;font-size:20px}
    #stakeInput{flex:0 0 110px;padding:8px 10px;border:1px solid #ddd;border-radius:8px;font-size:14px}
    .stake-wrap{display:flex;gap:8px;align-items:center;flex:1}
    .challenge-countdown{margin-top:6px;font-weight:600}
    .challenge-actions{display:flex;align-items:center;gap:8px;margin-top:10px}
    #tournaments .btn{background:#3b82f6;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}
    #tournaments .btn:hover{filter:brightness(1.05)}

    /* ======= –õ–Ü–î–ï–†–ë–û–†–î ======= */
    #leaderboard.themed{
      background-image:
        radial-gradient(1200px 500px at 15% 0%, rgba(99,102,241,.35), transparent 60%),
        radial-gradient(1000px 600px at 85% 100%, rgba(56,189,248,.25), transparent 60%),
        linear-gradient(135deg,#0f172a 0%, #1e1b4b 45%, #3b82f6 100%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="760" height="200"><g fill="%23ffffff15" font-family="Arial, Helvetica, sans-serif" font-size="36" font-weight="800" transform="rotate(-18 380 100)"><text x="-60" y="40">LEADERBOARD ‚Ä¢ LEADERBOARD ‚Ä¢ LEADERBOARD ‚Ä¢</text><text x="-60" y="100">LEADERBOARD ‚Ä¢ LEADERBOARD ‚Ä¢ LEADERBOARD ‚Ä¢</text><text x="-60" y="160">LEADERBOARD ‚Ä¢ LEADERBOARD ‚Ä¢ LEADERBOARD ‚Ä¢</text></g></svg>');
      background-size:auto,auto,auto,760px 200px;background-repeat:no-repeat,no-repeat,no-repeat,repeat;
      color:#eaf2ff; padding-bottom:calc(var(--menu-h) + 20px);
    }
    .lb-header{width:92%;margin:12px auto 8px}
    .lb-title{font-size:26px;margin:0 0 4px}
    .lb-sub{opacity:.9;margin:0 0 10px}
    .lb-note{width:92%;margin:4px auto 16px;font-size:13px;opacity:.9}
    #lbList{width:92%;margin:0 auto 18px}
    .lb-row{
      display:grid;
      grid-template-columns:56px 1fr 70px 90px;
      align-items:center;gap:10px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.15);
      padding:10px 12px;border-radius:12px;
      backdrop-filter:blur(6px);
      box-shadow:0 8px 20px rgba(0,0,0,.15);
      margin:0 0 8px 0;
    }
    .lb-rank{font-weight:900;font-size:18px;text-align:center}
    .lb-name{display:flex;align-items:center;gap:10px;min-width:0}
    .lb-name img{width:28px;height:28px;border-radius:50%;object-fit:cover;border:1px solid rgba(255,255,255,.3)}
    .lb-name .txt{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .lb-bonus{text-align:center;font-weight:800;opacity:.95}
    .lb-score{text-align:right;font-weight:800}
    .rank-1{background:linear-gradient(135deg,rgba(250,204,21,.25),rgba(255,255,255,.06));border-color:rgba(250,204,21,.6)}
    .rank-2{background:linear-gradient(135deg,rgba(148,163,184,.25),rgba(255,255,255,.06));border-color:rgba(148,163,184,.6)}
    .rank-3{background:linear-gradient(135deg,rgba(244,114,182,.25),rgba(255,255,255,.06));border-color:rgba(244,114,182,.6)}

    /* =====================
       PATCH: –º–æ–±—ñ–ª—å–Ω—ñ –ø—Ä–∞–≤–∫–∏ –¥–ª—è –±–∞—Ç–ª—ñ–≤
       ===================== */
    #tournaments .btn-sm{
      font-size:14px;
      padding:6px 10px;
      line-height:1;
      white-space:nowrap;
      flex:0 0 auto;
    }
    .stake-wrap{
      display:flex;
      align-items:center;
      gap:8px;
      flex:1 1 auto;
      min-width:0;
      flex-wrap:nowrap;
    }
    #stakeInput{
      width:90px;
      flex:0 0 auto;
    }
    @media (max-width:420px){
      #tournaments .challenge-row{ flex-wrap:wrap; }
      #tournaments label[for="stakeInput"]{ margin-bottom:6px; }
      #tournaments .btn-sm{ font-size:13px; padding:6px 10px; }
    }
  </style>

  <script>
    // –í–ò–î–ê–õ–ï–ù–û: Adexium SDK —Ç–∞ –π–æ–≥–æ –æ–±–≥–æ—Ä—Ç–∫–∞
  </script>
</head>
<body>

  <div class="city-skyline" id="citySkyline" aria-hidden="true"></div>

  <div id="game" class="page active">
    <div class="topbar">
      <div class="tb-left">
        <img id="tgAvatar" referrerpolicy="no-referrer"
             alt="Avatar"
             src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 64 64'><rect width='64' height='64' rx='12' fill='%239ca3af'/><circle cx='32' cy='24' r='12' fill='%23e5e7eb'/><path d='M10 54c0-10 10-16 22-16s22 6 22 16v4H10z' fill='%23e5e7eb'/></svg>'">
        <div id="tgTag" class="tg-tag">@guest</div>
      </div>
      <div class="tb-mid">
        <div id="score">0</div>
        <div id="highscore">üèÜ 0</div>
      </div>
      <div class="tb-right">
        <button id="langToggle" class="lang-btn">UA</button>
      </div>
    </div>

    <div id="container">
      <div id="instructions" data-i18n="instructions">
        –ö–ª—ñ–∫ –∞–±–æ –ø—Ä–æ–±—ñ–ª ‚Äî –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –±–ª–æ–∫. –ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è ‚Äî –∫–ª—ñ–∫–Ω–∏/–ø—Ä–æ–±—ñ–ª, —â–æ–± –∑—ñ–≥—Ä–∞—Ç–∏ —â–µ.
      </div>

      <div class="game-over" id="gameOver">
        <h2 data-i18n="game_over">–ì—Ä–∞ –∑–∞–∫—ñ–Ω—á–µ–Ω–∞</h2>
        <p data-i18n="nice_try">–¢–∏ –º–æ–ª–æ–¥–µ—Ü—å üëç</p>
        <p data-i18n="restart_hint">–ö–ª—ñ–∫–Ω–∏ –∞–±–æ –Ω–∞—Ç–∏—Å–Ω–∏ –ø—Ä–æ–±—ñ–ª, —â–æ–± –ø–æ—á–∞—Ç–∏ –∑–Ω–æ–≤—É</p>
      </div>

      <div class="ready" id="ready">
        <div id="start-button" style="cursor:pointer;" data-i18n="start_btn">‚ñ∂ –°—Ç–∞—Ä—Ç</div>
      </div>

      <div class="game-over" id="postAdTimer" style="display:none;">
        <h2 data-i18n="pause_before_new_game">–ü–∞—É–∑–∞ –ø–µ—Ä–µ–¥ –Ω–æ–≤–æ—é –≥—Ä–æ—Ä–æ—é</h2>
        <p><span data-i18n="you_can_start_in">–ú–æ–∂–Ω–∞ –±—É–¥–µ –ø–æ—á–∞—Ç–∏ —á–µ—Ä–µ–∑:</span>
          <b id="postAdCountdown">15</b> <span data-i18n="sec_suffix">—Å</span></p>
      </div>
    </div>
  </div>

  <div id="tasks" class="page themed">
    <h2 id="tasksTitle">üìã <span data-i18n="tasks_title">–ó–∞–≤–¥–∞–Ω–Ω—è</span></h2>

    
<div class="task" id="taskSubscribeAmbassador">
  <span>üí† –ü—ñ–¥–ø–∏—à–∏—Å—å –Ω–∞ –∞–º–±–∞—Å–∞–¥–æ—Ä–∞ (+1‚≠ê)</span>
  <div style="display:flex; gap:8px;">
    <button id="ambGoBtn" class="btn">–ü–µ—Ä–µ–π—Ç–∏</button>
    <button id="ambCheckBtn" class="btn">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
  </div>
</div>

<div class="task">
      <span data-i18n="task_subscribe_text">–ü—ñ–¥–ø–∏—à–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª +1‚≠ê</span>
      <button id="subscribeBtn" class="btn" data-i18n="open">–ü–µ—Ä–µ–π—Ç–∏</button>
    </div>

    <div class="task" id="task50" style="justify-content:space-between;">
      <span data-i18n="task_75_text">üéØ –î–æ—Å—è–≥–Ω–∏ —Ä–µ–∫–æ—Ä–¥—É 75 (+5.15‚≠ê)</span>
      <button id="checkTask50" class="btn" style="margin-left:auto;" data-i18n="check">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
    </div>

    <div class="task" id="taskAdsgramDaily">
      <span>üé¨ Adsgram: +0.1‚≠ê ‚Äî <b id="adGramCounter">0</b>/25 —Å—å–æ–≥–æ–¥–Ω—ñ</span>
      <button id="watchAdsgramDailyBtn" class="btn">–î–∏–≤–∏—Ç–∏—Å—å</button>
    </div>

    <div class="task" id="taskWatch5">
      <span><span data-i18n="task_5ads_text">üé¨ –ü–µ—Ä–µ–≥–ª—è–Ω—å 5 —Ä–µ–∫–ª–∞–º (+1‚≠ê)</span> ‚Äî <b id="ad5Counter">0/5</b></span>
      <button id="watchAd5Btn" class="btn" data-i18n="watch">–î–∏–≤–∏—Ç–∏—Å—è</button>
    </div>
    <div class="task" id="taskWatch5Cooldown" style="display:none;">
      <span>‚åõ <span data-i18n="task_5ads_available_in">¬´5 —Ä–µ–∫–ª–∞–º¬ª –¥–æ—Å—Ç—É–ø–Ω–µ —á–µ—Ä–µ–∑:</span>
        <span id="ad5CooldownText">‚Äî</span></span>
      <button class="btn" disabled data-i18n="wait">–û—á—ñ–∫—É–π‚Ä¶</button>
    </div>

    <div class="task" id="taskWatch10">
      <span><span data-i18n="task_10ads_text">üé¨ –ü–µ—Ä–µ–≥–ª—è–Ω—å 10 —Ä–µ–∫–ª–∞–º (+1.85‚≠ê)</span> ‚Äî <b id="ad10Counter">0/10</b></span>
      <button id="watchAd10Btn" class="btn" data-i18n="watch">–î–∏–≤–∏—Ç–∏—Å—è</button>
    </div>
    <div class="task" id="taskWatch10Cooldown" style="display:none;">
      <span>‚åõ <span data-i18n="task_10ads_available_in">¬´10 —Ä–µ–∫–ª–∞–º¬ª –¥–æ—Å—Ç—É–ø–Ω–µ —á–µ—Ä–µ–∑:</span>
        <span id="ad10CooldownText">‚Äî</span></span>
      <button class="btn" disabled data-i18n="wait">–û—á—ñ–∫—É–π‚Ä¶</button>
    </div>

    <div class="task" id="taskGames100" style="justify-content:space-between;">
      <span data-i18n="task_100games_text">üéÆ –ó—ñ–≥—Ä–∞–π 100 —ñ–≥–æ—Ä (+5‚≠ê) ‚Äî –∑—ñ–≥—Ä–∞–Ω–æ:
        <b id='gamesPlayedCounter'>0</b>/100</span>
      <button id="checkGames100Btn" class="btn" style="margin-left:auto;" data-i18n="check">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
    </div>
  </div>

  <div id="leaderboard" class="page themed">
    <div class="lb-header">
      <h2 class="lb-title">üèÜ <span data-i18n="lb_title">–õ—ñ–¥–µ—Ä–±–æ—Ä–¥</span></h2>
      <div class="lb-sub" data-i18n="lb_sub">–ü–æ–ø–∞–¥–∞–π —É –¢–û–ü ‚Äî –æ—Ç—Ä–∏–º—É–π –±—ñ–ª—å—à–µ ‚≠ê –∑–∞ –º—ñ—Å—Ü–µ!</div>
    </div>
    <div id="lbList"></div>
    <div class="lb-note" id="lbNote"></div>
  </div>

  <div id="tournaments" class="page">
    <div class="tour-hero">
      <div class="tour-hero-title" data-i18n="b_tour_title">‚öîÔ∏è –í–∏–∫–ª–∏–∫ —Å—É–ø–µ—Ä–Ω–∏–∫–∞</div>
      <div class="tour-hero-sub" data-i18n="b_tour_sub">–ó–≥–µ–Ω–µ—Ä—É–π —Ä–µ–∫–æ—Ä–¥, –∑—Ä–æ–±–∏ —Å—Ç–∞–≤–∫—É ‚≠ê —ñ –ø–æ–±–∏–π –π–æ–≥–æ –∑–∞ 3 –≥–æ–¥–∏–Ω–∏</div>
    </div>

    <div class="challenge-card">
      <div class="challenge-row">
        <div>
          <div class="muted" data-i18n="opponent">–°—É–ø–µ—Ä–Ω–∏–∫</div>
          <div class="opponent-score" id="opponentScore">‚Äî</div>
        </div>
        <button class="btn" id="genOpponentBtn" data-i18n="generate">–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
      </div>

      <div class="challenge-row">
        <label for="stakeInput" class="muted" data-i18n="stake">–°—Ç–∞–≤–∫–∞ ‚≠ê</label>
        <div class="stake-wrap">
          <input id="stakeInput" type="number" min="1" step="0.5" value="1" />
          <button class="btn btn-sm" id="startChallengeBtn" data-i18n="start_challenge">–°—Ç–∞—Ä—Ç</button>
        </div>
      </div>

      <div class="challenge-info" id="challengeInfo" data-i18n="no_active_challenge">–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É.</div>

      <div class="challenge-countdown" id="challengeCountdown" style="display:none;">
        ‚è≥ <span data-i18n="time_left_prefix">–ó–∞–ª–∏—à–∏–ª–æ—Å—å:</span> <span id="challengeLeft">03:00:00</span>
      </div>

      <div class="challenge-actions">
        <button class="btn" id="checkChallengeBtn" disabled data-i18n="check">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
        <span id="challengeStatus" class="muted"></span>
      </div>
    </div>

    <div class="battle-panel" aria-label="–ü—Ä–∞–≤–∏–ª–∞ –±–∞—Ç–ª—É" style="width:92%; margin:14px auto calc(var(--menu-h) + 32px);border-radius:16px; overflow:hidden;background:
      linear-gradient(135deg, rgba(30,27,75,.85), rgba(37,99,235,.85)),
      url('data:image/svg+xml;utf8,<svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;280&quot; height=&quot;280&quot; viewBox=&quot;0 0 280 280&quot;><g fill=&quot;none&quot; stroke=&quot;%23ffffff22&quot;><path d=&quot;M0 40h280M0 80h280M0 120h280M0 160h280M0 200h280M0 240h280&quot;/><path d=&quot;M40 0v280M80 0v280M120 0v280M160 0v280M200 0v280M240 0v280&quot;/></g></svg>') center/280px repeat;
      border:1px solid rgba(255,255,255,.18);color:#eaf2ff; box-shadow:0 10px 30px rgba(0,0,0,.2)">
      <div class="inner" style="display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;padding:14px 16px">
        <div class="title" style="display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.5px;text-transform:uppercase">
          <div class="logo" style="width:38px;height:38px;border-radius:12px;background:radial-gradient(circle at 30% 30%, #93c5fd, #6366f1);box-shadow:inset 0 1px 0 rgba(255,255,255,.35), 0 6px 16px rgba(99,102,241,.35);display:grid;place-items:center;font-size:20px">‚öîÔ∏è</div>
          <div>BATTLES</div>
        </div>
        <div class="rules" style="display:flex;gap:10px;flex:1;min-width:220px;justify-content:center;flex-wrap:wrap">
          <div class="pill" style="background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18);padding:6px 10px;border-radius:999px;font-weight:700;font-size:13px" data-i18n="rule_goal">üéØ –ú–µ—Ç–∞: –ø–æ–±–∏–π —Ä–µ–∫–æ—Ä–¥ –∑–∞ 3 –≥–æ–¥</div>
          <div class="pill" style="background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18);padding:6px 10px;border-radius:999px;font-weight:700;font-size:13px" data-i18n="rule_prize">üíé –í–∏–≥—Ä–∞—à: √ó1.5 –≤—ñ–¥ —Å—Ç–∞–≤–∫–∏</div>
          <div class="pill" style="background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18);padding:6px 10px;border-radius:999px;font-weight:700;font-size:13px" data-i18n="rule_risk">‚ö†Ô∏è –Ø–∫—â–æ –Ω–µ –≤—Å—Ç–∏–≥–∞—î—à ‚Äî —Å—Ç–∞–≤–∫–∞ –∑–≥–æ—Ä–∞—î</div>
        </div>
        <div class="cta" style="display:flex;gap:8px;align-items:center">
          <button class="btn" onclick="document.getElementById('stakeInput').focus()" data-i18n="make_bet">–ó—Ä–æ–±–∏—Ç–∏ —Å—Ç–∞–≤–∫—É</button>
        </div>
      </div>
    </div>
  </div>

  <div id="friends" class="page themed">
    <div class="balance"><span data-i18n="balance">–ë–∞–ª–∞–Ω—Å</span> ‚≠ê <span id="balance">0</span></div>
    <h2 class="wallet-title">üí≥ <span data-i18n="wallet">–ì–∞–º–∞–Ω–µ—Ü—å</span></h2>

    <div class="share-card">
      <div><strong data-i18n="invite_friends">–ó–∞–ø—Ä–æ—Å–∏ –¥—Ä—É–∑—ñ–≤</strong></div>
      <p class="muted" data-i18n="bot_link">–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –±–æ—Ç–∞:</p>
      <p style="margin:8px 0;">
        <a href="https://t.me/Stacktongame_bot" class="btn" onclick="openBotLink(event)" data-i18n="open_bot">‚û° –í—ñ–¥–∫—Ä–∏—Ç–∏ –±–æ—Ç–∞ @Stacktongame_bot</a>
      </p>
      <div class="share-row">
        <input id="shareLink" type="text" readonly value="https://t.me/Stacktongame_bot"/>
        <button class="btn" id="copyShareBtn" data-i18n="copy">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏</button>
      </div>
      <div class="muted" data-i18n="one_link">–¶–µ –æ–¥–Ω–∞ —Å–∏–ª–∫–∞ –¥–ª—è –≤—Å—ñ—Ö üëç</div>
    </div>

    <div class="share-card">
      <div><strong data-i18n="withdraw_title">–í–∏–≤—ñ–¥ –∑—ñ—Ä–æ–∫</strong></div>
      <div class="muted" data-i18n="withdraw_hint">
        –ó–∞ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è —Å–ø–∏—Å—É—î—Ç—å—Å—è —Ä—ñ–≤–Ω–æ 50‚≠ê, —Ä–µ—à—Ç–∞ –ª–∏—à–∞—î—Ç—å—Å—è. –î–∞–ª—ñ –≤ —Ç–∞–±–ª–∏—Ü—é –ø—ñ–¥–µ –≤–∞—à —Ç–µ–≥(@) —Ç–∞–∫ —â–æ –¥–æ –º–æ–º–µ–Ω—Ç—É —É—Å–ø—ñ—à–Ω–æ–≥–æ –≤–∏–≤–æ–¥—É –Ω–µ –º—ñ–Ω—è–π—Ç–µ –π–æ–≥–æ.
      </div>
      <div class="share-actions">
        <button class="btn" id="withdrawBtn" data-i18n="withdraw_btn">–í–∏–≤–µ—Å—Ç–∏</button>
        <span id="withdrawStatus" class="muted"></span>
      </div>
    </div>

    <div class="share-card">
      <div><strong data-i18n="payout_list_title">–°–ø–∏—Å–æ–∫ –≤–∏–≤–æ–¥—ñ–≤</strong></div>
      <ul id="payoutList" class="payout-list"></ul>
    </div>
  </div>

  <div id="shop" class="page themed">
    <div style="margin: 12px auto; width: 90%; text-align:center;">
        <h1 style="font-size: 28px; margin: 0 0 20px; color: #eaf2ff; text-transform: uppercase; letter-spacing: 1px; font-weight: 800;">–°–ø—ñ–≤–ø—Ä–∞—Ü—è</h1>
    </div>
    
    <div class="share-card shop-card" style="text-align:left; padding: 20px;">
        <p style="margin-bottom: 20px;">
            <strong style="font-size: 1.1em; color: #fff;">1) –ü—Ä–∞–≥–Ω–µ—Ç–µ —Å—Ç–∞—Ç–∏ –∞–º–±–∞—Å–∞–¥–æ—Ä–æ–º –Ω–∞—à–æ—ó –≥—Ä–∏?</strong> <br>
            <span style="opacity: 0.9;">–£–º–æ–≤–∏ —Å–ø—ñ–≤–ø—Ä–∞—Ü—ñ: –º–∞—Ç–∏ –∫–∞–Ω–∞–ª 1–∫+ –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤ —Ç–∞ –∞–∫—Ç–∏–≤–Ω—É –∞—É–¥–∏—Ç–æ—Ä—ñ—é.</span> <br>
            <span style="opacity: 0.9;">–ü–µ—Ä–µ–≤–∞–≥–∏: –ø—Ä–∏—Ö—ñ–¥ –Ω–æ–≤–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É –≤–∞—à –∫–∞–Ω–∞–ª.</span>
        </p>
        <p style="margin-bottom: 20px;">
            <strong style="font-size: 1.1em; color: #fff;">2) –ü—Ä–∞–≥–Ω–µ—Ç–µ –¥–æ–¥–∞—Ç–∏ —Å–≤–æ—î –∑–∞–≤–¥–∞–Ω–Ω—è –≤ –≥—Ä—É?</strong> <br>
            <span style="opacity: 0.9;">–ü–∏—à—ñ—Ç—å -</span> 
            <a href="#" class="tg-tag" style="color: #3b82f6; text-decoration: none; font-weight: bold;" onclick="openDMto('@yArOsUlAv'); return false;">@yArOsUlAv</a>
        </p>
        <p style="margin-bottom: 0;">
            <strong style="font-size: 1.1em; color: #fff;">3) –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –≥—Ä–∏</strong> - 
            <a href="#" class="tg-tag" style="color: #3b82f6; text-decoration: none; font-weight: bold;" onclick="openDMto('@–ø–æ–∫–∏–ø—É—Å—Ç–æ'); return false;">@–ø–æ–∫–∏–ø—É—Å—Ç–æ</a>
        </p>
    </div>
    </div>

  <div class="menu">
    <button onclick="showPage('game', this)" class="active">üéÆ</button>
    <button onclick="showPage('tasks', this)">üìù</button>
    <button onclick="showPage('leaderboard', this)">üèÜ</button>
    <button onclick="showPage('tournaments', this)">‚öîÔ∏è</button>
    <button onclick="showPage('friends', this)">üëõ</button>
    <button onclick="showPage('shop', this)">ü§ù</button> </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r83/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenMax.min.js"></script>
  <script src="https://sad.adsgram.ai/js/sad.min.js"></script>

  <script src="https://richinfo.co/richpartners/telegram/js/tg-ob.js"></script>
  <script>
    window.TelegramAdsController = new TelegramAdsController();
    window.TelegramAdsController.initialize({ pubId: "965326", appId: "3592" });
  </script>

  <script>
    function showPage(id, btn){
      document.querySelectorAll('.page').forEach(p => p.classList.toggle('active', p.id===id));
      document.querySelectorAll('.menu button').forEach(b => b.classList.toggle('active', b===btn));
      window.isPaused = (id !== 'game');
      if(id==='leaderboard'){ loadLeaderboard?.(); }
    }
    function openBotLink(e){
      if (window.Telegram && Telegram.WebApp) {
        Telegram.WebApp.openTelegramLink('https://t.me/Stacktongame_bot');
        e.preventDefault();
      }
    }
    function openDMto(username){
      const url = 'https://t.me/' + username.replace(/^@/,'');
      if (window.Telegram && Telegram.WebApp) Telegram.WebApp.openTelegramLink(url);
      else window.open(url,'_blank');
    }
    document.addEventListener('DOMContentLoaded', ()=>{
      // –í–∏–¥–∞–ª–µ–Ω–æ –æ–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è dmOwnerBtn, –æ—Å–∫—ñ–ª—å–∫–∏ –π–æ–≥–æ –Ω–µ–º–∞—î –≤ –Ω–æ–≤–æ–º—É –≤–º—ñ—Å—Ç—ñ
      // –í–∏–¥–∞–ª–µ–Ω–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è shopInfoBtn/Pop/Close, –æ—Å–∫—ñ–ª—å–∫–∏ —ó—Ö –Ω–µ–º–∞—î –≤ –Ω–æ–≤–æ–º—É –≤–º—ñ—Å—Ç—ñ

      // // –¶–µ–π –∫–æ–¥ –±—ñ–ª—å—à–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω, –±–æ –µ–ª–µ–º–µ–Ω—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω—ñ
      // document.getElementById('dmOwnerBtn')?.addEventListener('click', ()=>openDMto('@yArOsUlAv'));
      // const infoBtn = document.getElementById('shopInfoBtn');
      // const infoPop = document.getElementById('shopInfoPop');
      // const infoClose = document.getElementById('shopInfoClose');
      // infoBtn?.addEventListener('click', ()=>{ infoPop.style.display = (infoPop.style.display==='block'?'none':'block'); });
      // infoClose?.addEventListener('click', ()=>{ infoPop.style.display='none'; });
      // document.addEventListener('click', (e)=>{
      //   if (!infoPop || !infoBtn) return;
      //   if (!infoPop.contains(e.target) && !infoBtn.contains(e.target)) infoPop.style.display='none';
      // });
    });
  </script>

  <script>
    const LB_URL = 'https://raw.githubusercontent.com/yarikyoucan/stack-game-ton/main/leaderboard.json';

    function _avatarSvg(){
      return 'data:image/svg+xml;utf8,'+encodeURIComponent("<svg xmlns='http://www.w3.org/2000/svg' width='28' height='28'><rect width='28' height='28' rx='14' fill='#1f2a44'/><text x='14' y='18' text-anchor='middle' font-size='14' fill='#9fb3ff'>üë§</text></svg>");
    }

    async function fetchLeaderboard(){
      if(!LB_URL) return null;
      const url = LB_URL + (LB_URL.includes('?')?'&':'?') + 'v=' + Date.now();
      const r = await fetch(url,{headers:{'accept':'application/json'}});
      if(!r.ok) throw new Error('HTTP '+r.status);
      const data = await r.json();
      if(!Array.isArray(data)) throw new Error('Bad JSON format');
      return data;
    }

    function renderLeaderboard(rows){
      const list = document.getElementById('lbList');
      const note = document.getElementById('lbNote');
      if(!list) return;

      rows = Array.isArray(rows)? rows.slice(): [];
      rows.sort((a,b)=> (b?.score||0)-(a?.score||0));

      list.innerHTML='';
      for(let i=0;i<50;i++){
        const r = rows[i];
        const rank = i+1;
        const name = r ? (r.name || 'Player') : '‚Äî';
        const score = (r && typeof r.score==='number') ? r.score : '‚Äî';

        const row = document.createElement('div');
        row.className = 'lb-row ' + (rank===1?'rank-1':rank===2?'rank-2':rank===3?'rank-3':'');
        row.innerHTML = `
          <div class="lb-rank">${rank}</div>
          <div class="lb-name"><img src="${_avatarSvg()}" alt=""><span class="txt">${name}</span></div>
          <div class="lb-bonus">?‚≠ê</div>
          <div class="lb-score">${score}</div>
        `;
        list.appendChild(row);
      }
      if(note) note.textContent = '–û–Ω–æ–≤–ª–µ–Ω–æ –∑ GitHub.';
    }

    async function loadLeaderboard(){
      try{
        const data = await fetchLeaderboard();
        renderLeaderboard(data||[]);
      }catch(e){
        renderLeaderboard([]);
        const note = document.getElementById('lbNote');
        if(note) note.textContent = '–ù–µ –≤–¥–∞–ª–æ—Å—å –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ª—ñ–¥–µ—Ä–±–æ—Ä–¥.';
        console.warn('LB load error:', e);
      }
    }
    window.loadLeaderboard = loadLeaderboard;

    document.addEventListener('DOMContentLoaded', ()=>{
      if(document.getElementById('leaderboard')?.classList.contains('active')){
        loadLeaderboard();
      }
    });
  </script>

  <script>
    const I18N = {
      uk: {
        instructions: "–ö–ª—ñ–∫ –∞–±–æ –ø—Ä–æ–±—ñ–ª ‚Äî –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –±–ª–æ–∫. –ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è ‚Äî –∫–ª—ñ–∫–Ω–∏/–ø—Ä–æ–±—ñ–ª, —â–æ–± –∑—ñ–≥—Ä–∞—Ç–∏ —â–µ.",
        game_over: "–ì—Ä–∞ –∑–∞–∫—ñ–Ω—á–µ–Ω–∞",
        nice_try: "–¢–∏ –º–æ–ª–æ–¥–µ—Ü—å üëç",
        restart_hint: "–ö–ª—ñ–∫–Ω–∏ –∞–±–æ –Ω–∞—Ç–∏—Å–Ω–∏ –ø—Ä–æ–±—ñ–ª, —â–æ–± –ø–æ—á–∞—Ç–∏ –∑–Ω–æ–≤—É",
        start_btn: "‚ñ∂ –°—Ç–∞—Ä—Ç",
        pause_before_new_game: "–ü–∞—É–∑–∞ –ø–µ—Ä–µ–¥ –Ω–æ–≤–æ—é –≥—Ä–æ—Ä–æ—é",
        you_can_start_in: "–ú–æ–∂–Ω–∞ –±—É–¥–µ –ø–æ—á–∞—Ç–∏ —á–µ—Ä–µ–∑:",
        sec_suffix: "—Å",

        tasks_title: "–ó–∞–≤–¥–∞–Ω–Ω—è",
        task_subscribe_text: "–ü—ñ–¥–ø–∏—à–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª +1‚≠ê",
        open: "–ü–µ—Ä–µ–π—Ç–∏",
        done: "–í–∏–∫–æ–Ω–∞–Ω–æ",
        task_75_text: "üéØ –î–æ—Å—è–≥–Ω–∏ —Ä–µ–∫–æ—Ä–¥—É 75 (+5.15‚≠ê)",
        check: "–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏",
        // –í–ò–î–ê–õ–ï–ù–û: –ü–µ—Ä–µ–∫–ª–∞–¥–∏ –¥–ª—è –∑–∞–≤–¥–∞–Ω—å Adexium

        b_tour_title: "‚öîÔ∏è –í–∏–∫–ª–∏–∫ —Å—É–ø–µ—Ä–Ω–∏–∫–∞",
        b_tour_sub: "–ó–≥–µ–Ω–µ—Ä—É–π —Ä–µ–∫–æ—Ä–¥, –∑—Ä–æ–±–∏ —Å—Ç–∞–≤–∫—É ‚≠ê —ñ –ø–æ–±–∏–π –π–æ–≥–æ –∑–∞ 3 –≥–æ–¥–∏–Ω–∏",
        opponent: "–°—É–ø–µ—Ä–Ω–∏–∫",
        generate: "–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏",
        stake: "–°—Ç–∞–≤–∫–∞ ‚≠ê",
        start_challenge: "–°—Ç–∞—Ä—Ç",
        no_active_challenge: "–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É.",
        time_left_prefix: "–ó–∞–ª–∏—à–∏–ª–æ—Å—å:",
        rule_goal: "üéØ –ú–µ—Ç–∞: –ø–æ–±–∏–π —Ä–µ–∫–æ—Ä–¥ –∑–∞ 3 –≥–æ–¥",
        rule_prize: "üíé –í–∏–≥—Ä–∞—à: √ó1.5 –≤—ñ–¥ —Å—Ç–∞–≤–∫–∏",
        rule_risk: "‚ö†Ô∏è –Ø–∫—â–æ –Ω–µ –≤—Å—Ç–∏–≥–∞—î—à ‚Äî —Å—Ç–∞–≤–∫–∞ –∑–≥–æ—Ä–∞—î",
        make_bet: "–ó—Ä–æ–±–∏—Ç–∏ —Å—Ç–∞–≤–∫—É",

        balance: "–ë–∞–ª–∞–Ω—Å",
        wallet: "–ì–∞–º–∞–Ω–µ—Ü—å",
        invite_friends: "–ó–∞–ø—Ä–æ—Å–∏ –¥—Ä—É–∑—ñ–≤",
        bot_link: "–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –±–æ—Ç–∞:",
        open_bot: "‚û° –í—ñ–¥–∫—Ä–∏—Ç–∏ –±–æ—Ç–∞ @Stacktongame_bot",
        copy: "–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏",
        one_link: "–¶–µ –æ–¥–Ω–∞ —Å–∏–ª–∫–∞ –¥–ª—è –≤—Å—ñ—Ö üëç",
        withdraw_title: "–í–∏–≤—ñ–¥ –∑—ñ—Ä–æ–∫",
        withdraw_hint: "–ó–∞ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è —Å–ø–∏—Å—É—î—Ç—å—Å—è —Ä—ñ–≤–Ω–æ 50‚≠ê, –î–∞–ª—ñ –≤ —Ç–∞–±–ª–∏—Ü—é –ø—ñ–¥–µ –≤–∞—à —Ç–µ–≥(@) —Ç–∞–∫ —â–æ –¥–æ –º–æ–º–µ–Ω—Ç—É —É—Å–ø—ñ—à–Ω–æ–≥–æ –≤–∏–≤–æ–¥—É –Ω–µ –º—ñ–Ω—è–π—Ç–µ –π–æ–≥–æ.",
        withdraw_btn: "–í–∏–≤–µ—Å—Ç–∏",
        payout_list_title: "–°–ø–∏—Å–æ–∫ –≤–∏–≤–æ–¥—ñ–≤",

        // –í–ò–î–ê–õ–ï–ù–û: –ü–µ—Ä–µ–∫–ª–∞–¥–∏ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω—É
        // shop_announcements: "–û–≥–æ–ª–æ—à–µ–Ω–Ω—è",
        // post_announcement: "–í–∏—Å—Ç–∞–≤–∏—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è",
        // write_dm: "–ù–∞–ø–∏—Å–∞—Ç–∏ –≤ –ª—Å",
        // shop_info_text: "–Ø–∫—â–æ –±–∞–∂–∞—î—Ç–µ –ø—Ä–æ–¥–∞—Ç–∏ NFT, –∑—ñ—Ä–∫–∏ —á–∏ —ñ–Ω—à—ñ –ø–æ–¥–∞—Ä—É–Ω–∫–∏ ‚Äî –ø–∏—à—ñ—Ç—å —É –ª—Å.",
        // close: "–ó–∞–∫—Ä–∏—Ç–∏",

        lb_title: "–õ—ñ–¥–µ—Ä–±–æ—Ä–¥",
        lb_sub: "–ü–æ–ø–∞–¥–∞–π —É –¢–û–ü ‚Äî –æ—Ç—Ä–∏–º—É–π –±—ñ–ª—å—à–µ ‚≠ê –∑–∞ –º—ñ—Å—Ü–µ!"
      },
      en: {
        instructions: "Click or Space ‚Äî drop the block. After game over, click/space to play again.",
        game_over: "Game Over",
        nice_try: "Nice try üëç",
        restart_hint: "Click or press Space to start again",
        start_btn: "‚ñ∂ Start",
        pause_before_new_game: "Pause before new game",
        you_can_start_in: "You can start in:",
        sec_suffix: "s",

        tasks_title: "Tasks",
        task_subscribe_text: "Subscribe to channel +1‚≠ê",
        open: "Open",
        done: "Done",
        task_75_text: "üéØ Reach 75 highscore (+5.15‚≠ê)",
        check: "Check",
        // –í–ò–î–ê–õ–ï–ù–û: –ü–µ—Ä–µ–∫–ª–∞–¥–∏ –¥–ª—è –∑–∞–≤–¥–∞–Ω—å Adexium

        b_tour_title: "‚öîÔ∏è Challenge an opponent",
        b_tour_sub: "Generate a target, place a ‚≠ê bet and beat it within 3 hours",
        opponent: "Opponent",
        generate: "Generate",
        stake: "Stake ‚≠ê",
        start_challenge: "Start",
        no_active_challenge: "No active challenge.",
        time_left_prefix: "Time left:",
        rule_goal: "üéØ Goal: beat the score in 3 hours",
        rule_prize: "üíé Prize: √ó1.5 of your stake",
        rule_risk: "‚ö†Ô∏è If you fail ‚Äî you lose the stake",
        make_bet: "Make a bet",

        balance: "Balance",
        wallet: "Wallet",
        invite_friends: "Invite friends",
        bot_link: "Bot link:",
        open_bot: "‚û° Open @Stacktongame_bot",
        copy: "Copy",
        one_link: "Same link for everyone üëç",
        withdraw_title: "Withdraw stars",
        withdraw_hint: "Clicking deducts exactly 50‚≠ê. Next, your tag (@) will go into the table, so do not change it until the output is successful.",
        withdraw_btn: "Withdraw",
        payout_list_title: "Payouts",

        // –í–ò–î–ê–õ–ï–ù–û: –ü–µ—Ä–µ–∫–ª–∞–¥–∏ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω—É
        // shop_announcements: "Announcements",
        // post_announcement: "Post an announcement",
        // write_dm: "Message in DM",
        // shop_info_text: "If you want to sell NFTs, stars or other gifts ‚Äî message me in DM.",
        // close: "Close",

        lb_title: "Leaderboard",
        lb_sub: "Climb the TOP ‚Äî earn more ‚≠ê for your rank!"
      }
    };

    function applyLang(lang){
      const dict = I18N[lang] || I18N.uk;
      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const key = el.getAttribute('data-i18n');
        if (dict[key] != null) el.innerHTML = dict[key];
      });
      const subBtn=document.getElementById('subscribeBtn');
      if (subBtn){
        const subscribed=(localStorage.getItem('subscribed')==='true');
        subBtn.textContent = subscribed ? dict.done : dict.open;
      }
      const btn=document.getElementById('langToggle');
      if (btn) btn.textContent = (lang==='en'?'EN':'UA');
      localStorage.setItem('lang', lang);
      document.documentElement.setAttribute('lang', lang==='en'?'en':'uk');
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      const saved = localStorage.getItem('lang') || 'uk';
      applyLang(saved);
      document.getElementById('langToggle')?.addEventListener('click', ()=>{
        const cur = localStorage.getItem('lang') || 'uk';
        applyLang(cur==='uk' ? 'en' : 'uk');
      });
    });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const tg = window.Telegram?.WebApp;
      try { tg?.expand?.(); } catch(e) {}

      const user = tg?.initDataUnsafe?.user || null;
      const tagEl = document.getElementById('tgTag');
      const avatarEl = document.getElementById('tgAvatar');

      let display = '@guest';
      if (user?.username) display = '@' + user.username;
      else if (user?.first_name || user?.last_name) display = [user.first_name, user.last_name].filter(Boolean).join(' ');

      if (tagEl) tagEl.textContent = display;

      if (user?.photo_url && avatarEl){
        avatarEl.src = user.photo_url;
        avatarEl.addEventListener('error', () => {
          fetch(user.photo_url, {cache:'no-store'})
            .then(r => r.blob())
            .then(b => new Promise(res => {const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.readAsDataURL(b);} ))
            .then(dataUrl => { avatarEl.src = dataUrl; })
            .catch(()=>{});
        }, {once:true});
      }
    });
  </script>

 <script>
  window.CLOUD_URL     = "https://script.google.com/macros/s/AKfycbxgak6ZgIqIY2mDkGUOCzYnksnSanjjM4UMryAdI1vV-ReFopFPoowg3muuvSBHrOILwA/exec";
  window.CLOUD_API_KEY = "cgdhggfgf45d6e45wsd6w3sd5";
</script>

<script>
  window.WITHDRAW_CLOUD_URL = "https://script.google.com/macros/s/AKfycbzD5GxjFHSD7KFosC33qNqGVT4zcbxhGJ_QgR5pa8mVaIv-hc-ZoTK11nAksvtegZ9/exec";
  window.WITHDRAW_API_KEY   = "vgkgfghfgdxkyovbyuofyuf767f67ed54j";
</script>


  <script src="./script.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', ()=>{
      const skyline = document.getElementById('citySkyline');
      if (!skyline) return;

      function makeWindowsSVG(w, h){
        const cols = Math.max(3, Math.round(w / 12));
        const rows = Math.max(6, Math.round(h / 14));
        const gapX = Math.max(2, Math.round(w * 0.02));
        const gapY = Math.max(2, Math.round(h * 0.025));
        const winW = Math.max(6, Math.floor((w - (cols - 1) * gapX) / cols));
        const winH = Math.max(8, Math.floor((h - (rows - 1) * gapY) / rows));

        const base = 0.48 + (Math.random() * 0.18);
        const phase = Math.random() * Math.PI * 2;

        const warm = ['#ffd166','#ffe29a','#fff1c4','#ffc86b','#ffd98c'];
        const cool = ['#a7c4ff','#8ecbff','#b3f0ff'];

        const defs = `
          <defs>
            <filter id="glow" color-interpolation-filters="sRGB">
              <feGaussianBlur stdDeviation="0.7" result="b"/>
              <feMerge>
                <feMergeNode in="b"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
          </defs>`;

        let litRects = '';
        for (let r = 0; r < rows; r++){
          let p = base + 0.18 * Math.sin(r * 0.9 + phase) - 0.07 * (r / rows);
          p = Math.max(0.18, Math.min(0.88, p));
          for (let c = 0; c < cols; c++){
            if (Math.random() < p){
              const x = Math.round(c * (winW + gapX));
              const y = Math.round(r * (winH + gapY));
              const tv = Math.random() < 0.06;
              const col = tv ? cool[(Math.random()*cool.length)|0] : warm[(Math.random()*warm.length)|0];
              const op = tv ? (0.75 + Math.random()*0.2) : (0.85 + Math.random()*0.15);
              const hasBlinds = Math.random() < 0.18;
              const blindsH = hasBlinds ? Math.max(2, Math.round(winH * (0.25 + Math.random()*0.3))) : 0;

              litRects += `<g filter="url(#glow)">
                <rect x="${x}" y="${y}" width="${winW}" height="${winH}" rx="1.2" ry="1.2" fill="${col}" fill-opacity="${op}"/>
                ${hasBlinds ? `<rect x="${x}" y="${y}" width="${winW}" height="${blindsH}" fill="rgba(0,0,0,.18)"/>` : ``}
              </g>`;
            }
          }
        }

        let frames = '';
        for (let c = 1; c < cols; c++){
          const fx = Math.round(c * (winW + gapX) - gapX/2);
          frames += `<rect x="${fx}" y="0" width="1" height="${h}" fill="rgba(5,8,15,.35)"/>`;
        }
        for (let r = 1; r < rows; r++){
          const fy = Math.round(r * (winH + gapY) - gapY/2);
          frames += `<rect x="0" y="${fy}" width="${w}" height="${1}" fill="rgba(5,8,15,.35)"/>`;
        }

        const svg = `
          <svg xmlns="http://www.w3.org/2000/svg" width="${w}" height="${h}" viewBox="0 0 ${w} ${h}" shape-rendering="crispEdges">
            ${defs}
            <rect width="100%" height="100%" fill="rgba(8,12,22,.85)"/>
            ${frames}
            ${litRects}
          </svg>`;
        return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
      }

      function buildSkyline(){
        skyline.innerHTML = '';
        const count = Math.max(8, Math.round(window.innerWidth / 70));
        for (let i=0;i<count;i++){
          const b = document.createElement('div');
          b.className = 'bldg';
          const h = Math.floor(Math.random()*20)+12; // 12‚Äì32vh
          b.style.setProperty('--h', h+'vh');

          b.style.setProperty('--twinkle', (5 + Math.random()*4).toFixed(2) + 's');
          b.style.setProperty('--twinkle-delay', (Math.random()*3).toFixed(2) + 's');

          skyline.appendChild(b);

          const glassW = Math.max(20, b.clientWidth  - 16);
          const glassH = Math.max(20, b.clientHeight - 22);

          const win = document.createElement('div');
          win.className = 'win';
          win.style.backgroundImage = `url("${makeWindowsSVG(glassW, glassH)}")`;
          b.appendChild(win);
        }
      }

      buildSkyline();
      window.addEventListener('resize', buildSkyline);
    });
  </script>
</body>
</html>
