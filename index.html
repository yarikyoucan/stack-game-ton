<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Stack Game</title>
  <style>
    body {
      margin: 0;
      background: linear-gradient(to bottom, #a8edea, #fed6e3);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      font-family: sans-serif;
    }

    #game {
      position: relative;
      width: 300px;
      height: 500px;
      background-color: #111;
      overflow: hidden;
      border-radius: 12px;
    }

    .block {
      position: absolute;
      height: 30px;
      background-color: hsl(200, 70%, 60%);
      border-radius: 6px;
    }

    #startButton {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
    }

    #score {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="game">
    <div id="score">0</div>
    <button id="startButton">Старт</button>
  </div>

  <script>
    const game = document.getElementById('game');
    const scoreEl = document.getElementById('score');
    const startButton = document.getElementById('startButton');

    let blocks = [];
    let currentBlock = null;
    let animation;
    let speed = 2;
    let direction = 1;
    let score = 0;

    function createBlock(y) {
      const block = document.createElement('div');
      block.classList.add('block');
      block.style.width = blocks.length ? blocks[blocks.length - 1].offsetWidth + 'px' : '300px';
      block.style.left = '0px';
      block.style.top = y + 'px';
      block.style.backgroundColor = hsl(${200 + blocks.length * 20}, 70%, 60%);
      game.appendChild(block);
      return block;
    }

    function startGame() {
      blocks.forEach(b => b.remove());
      blocks = [];
      score = 0;
      speed = 2;
      scoreEl.textContent = '0';
      startButton.style.display = 'none';
      addBlock();
    }

    function addBlock() {
      const y = 470 - blocks.length * 30;
      currentBlock = createBlock(y);
      moveBlock();
      document.addEventListener('keydown', stopBlockOnce);
      game.addEventListener('click', stopBlockOnce);
    }

    function moveBlock() {
      let pos = 0;
      animation = setInterval(() => {
        if (!currentBlock) return;
        pos += speed * direction;
        if (pos > game.clientWidth - currentBlock.offsetWidth || pos < 0) direction *= -1;
        currentBlock.style.left = pos + 'px';
      }, 10);
    }

    function stopBlockOnce() {
      clearInterval(animation);
      document.removeEventListener('keydown', stopBlockOnce);
      game.removeEventListener('click', stopBlockOnce);

      const prev = blocks[blocks.length - 1];
      const currLeft = parseInt(currentBlock.style.left);
      const prevLeft = prev ? parseInt(prev.style.left) : 0;
      const diff = currLeft - prevLeft;

      if (Math.abs(diff) > (prev ? prev.offsetWidth : 300)) {
        endGame();
        return;
      }

      if (prev) {
        const newWidth = prev.offsetWidth - Math.abs(diff);
        currentBlock.style.width = newWidth + 'px';
        currentBlock.style.left = Math.max(currLeft, prevLeft) + 'px';
      }

      blocks.push(currentBlock);
      score++;
      scoreEl.textContent = score;

      if (currentBlock.offsetWidth <= 10) {
        endGame();
        return;
      }

      addBlock();
    }

    function endGame() {
      startButton.style.display = 'block';
    }

    startButton.addEventListener('click', startGame);
  </script>
</body>
</html>
